Captive portal

Заходим в captive portal и создаем zone 


Выбераем интерфейс тот который смотрит в сторону той машины где мы будет работать captive portal
В Allow inbound выбераем сети к которым будем иметь доступ ( локальные )
В Authenticate using выбераем Local Database ( это локальная база откуда мы будем брать логин и пароль ) 
 В конце можно по желанию добавить описание для этой зоны
Сохраням и выходим

Заходим в System > Access > Users и там добавляем пользователя под которым мы будем авторизироваться
Нажимаем + для создания
х
Указываем username ( Пример: guest ) пароль ( P@ssw0rd ) ( другие настройки я не менял )
Делаем правила для работы captive portal
Заходим в Firewall > Rules > OPT2
+

Нажимаем на + и создаем правила
Первое правило (разрешаем выход в интернет ) не забываем убрать галочку Quick ( она нужна чтобы правило работало после других и не давало сразу доступ )


Второе и третье правило (запрещаем доступ к локальной сети)


Тут я запретил доступ к сети где у меня pc-rnd


Тут я запретил доступ к сети где у меня dc-rnd ( обязательно надо убрать галочку Quick )
Четвертое правило ( разрешаем заходить в логин captive portal )


Пятое и шестое правило ( даем доступ к локальным ресурсам нужные для выполнения задания ) 


И по такому же принципу создаем правило с разрешение 53 порта для DNS

	Далее заходим на nb-rnd
	Открываем браузер и пишем http://192.168.12.1:8000 ( 192.168.12.1 - локальная айпи )

*информацию я брал и переделал немного оттуда: https://www.zenarmor.com/docs/network-security-tutorials/how-to-configure-captive-portal-on-opnsense




